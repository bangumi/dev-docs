openapi: 3.0.2
info:
  title: Bangumi Private API
  version: ''
  description: '`next.bgm.tv` åŸŸåä¸æ”¯æŒè·¨åŸŸï¼Œ'
servers:
  - url: https://next.bgm.tv
    description: Production server
tags:
  - name: Auth
paths:
  /p/login:
    post:
      tags:
        - Auth
      summary: ç™»å½•
      operationId: login
      description: >
        `h-captcha-response` æ˜¯ [hCaptcha
        çš„éªŒè¯ç ](https://docs.hcaptcha.com/#add-the-hcaptcha-widget-to-your-webpage)


        site key æ˜¯ `4874acee-9c6e-4e47-99ad-e2ea1606961f`
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - h-captcha-response
              properties:
                email:
                  type: string
                password:
                  type: string
                h-captcha-response:
                  type: string
      responses:
        '200':
          description: è´¦å·å¯†ç æ­£ç¡®ï¼Œè®¾ç½® Cookies
          headers:
            Set-Cookie:
              description: è®¾ç½® cookies session
              schema:
                type: string
                example: sessionID=abcde12345; Path=/; HttpOnly
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: è¯·æ±‚é”™è¯¯æˆ–è€…éªŒè¯ç é”™è¯¯
          content:
            application/json:
              example:
                title: Bad Request
                details:
                  - Emailä¸ºå¿…å¡«å­—æ®µ
                  - Passwordä¸ºå¿…å¡«å­—æ®µ
                  - HCaptchaResponseä¸ºå¿…å¡«å­—æ®µ
                description: can't validate request body
              schema:
                title: ErrorDetail
                required:
                  - title
                  - description
                  - detail
                type: object
                properties:
                  title:
                    title: Title
                    type: string
                  description:
                    title: Description
                    type: string
                  detail:
                    title: Detail
                    type: array
                    items:
                      type: string
        '401':
          description: è´¦å·æˆ–å¯†ç é”™è¯¯
          content:
            application/json:
              schema:
                title: ErrorDetail
                required:
                  - title
                  - description
                  - detail
                type: object
                properties:
                  title:
                    title: Title
                    type: string
                  description:
                    title: Description
                    type: string
                  detail:
                    title: Detail
                    type: object
                    properties:
                      remain:
                        type: integer
                        description: å‰©ä½™å¯ç”¨ç™»å½•æ¬¡æ•°ã€‚
        '422':
          description: æ— æ³•ä»¥ JSON æ ¼å¼è§£æè¯·æ±‚
        '502':
          description: hCaptcha HTTP è¯·æ±‚å¤±è´¥
  /p/logout:
    post:
      tags:
        - Auth
      summary: ç™»å‡º
      operationId: logout
      security:
        - CookiesSession: []
      responses:
        '204':
          description: æ­£å¸¸ç™»å‡º
        '401':
          description: ç”¨æˆ·æœªç™»å½•æˆ–è€… session å·²å¤±æ•ˆ
  /p/me:
    get:
      tags:
        - Auth
      summary: è·å–å½“å‰ç”¨æˆ·
      operationId: getCurrentUser
      security:
        - CookiesSession: []
      responses:
        '200':
          description: è¿”å›å½“å‰ç”¨æˆ·
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: ç”¨æˆ·æœªç™»å½•æˆ–è€… session å·²å¤±æ•ˆ
components:
  schemas:
    User:
      example:
        avatar:
          large: https://lain.bgm.tv/pic/user/l/000/00/00/1.jpg?r=1391790456
          medium: https://lain.bgm.tv/pic/user/m/000/00/00/1.jpg?r=1391790456
          small: https://lain.bgm.tv/pic/user/s/000/00/00/1.jpg?r=1391790456
        sign: Awesome!
        username: sai
        nickname: SaiğŸ––
        id: 1
        user_group: 1
      title: User
      description: |
        å®é™…çš„è¿”å›å€¼å¯èƒ½åŒ…æ‹¬æ–‡æ¡£æœªå£°æ˜çš„ `url` å­—æ®µï¼Œæ­¤å­—æ®µä¸»è¦ç”¨äºå¼€å‘è€…ä» api å“åº”ç›´æ¥è½¬è·³åˆ°ç½‘é¡µã€‚
        å®¢æˆ·ç«¯å¼€å‘è€…è¯·ä¸ç”¨ä¾èµ–äºæ­¤ç‰¹æ€§ï¼Œæ­¤å­—æ®µçš„å€¼éšæ—¶å¯èƒ½ä¼šæ”¹å˜ã€‚
      required:
        - id
        - username
        - nickname
        - user_group
        - avatar
        - sign
      type: object
      properties:
        id:
          title: ID
          type: integer
        username:
          title: Username
          type: string
          description: å”¯ä¸€ç”¨æˆ·åï¼Œåˆå§‹ä¸ UID ç›¸åŒï¼Œå¯ä¿®æ”¹ä¸€æ¬¡
        nickname:
          title: Nickname
          type: string
        user_group:
          title: UserGroup
          enum:
            - 1
            - 2
            - 3
            - 4
            - 5
            - 8
            - 9
            - 10
            - 11
          type: integer
          description: >-
            ç”¨æˆ·ç»„ - 1 = ç®¡ç†å‘˜ - 2 = Bangumi ç®¡ç†çŒ¿ - 3 = å¤©çª—ç®¡ç†çŒ¿ - 4 = ç¦è¨€ç”¨æˆ· - 5 = ç¦æ­¢è®¿é—®ç”¨æˆ·
            - 8 = äººç‰©ç®¡ç†çŒ¿ - 9 = ç»´åŸºæ¡ç›®ç®¡ç†çŒ¿ - 10 = ç”¨æˆ· - 11 = ç»´åŸºäºº
          x-ms-enum:
            name: UserGroup
            modelAsString: false
            values:
              - Admin
              - BangumiAdmin
              - DoujinAdmin
              - MutedUser
              - BlockedUser
              - PersonAdmin
              - WikiAdmin
              - User
              - WikiUser
          x-enum-varnames:
            - Admin
            - BangumiAdmin
            - DoujinAdmin
            - MutedUser
            - BlockedUser
            - PersonAdmin
            - WikiAdmin
            - User
            - WikiUser
        avatar:
          $ref: '#/components/schemas/Avatar'
        sign:
          title: Sign
          description: ä¸ªäººç­¾å
          type: string
    Avatar:
      title: Avatar
      required:
        - large
        - medium
        - small
      type: object
      properties:
        large:
          title: Large
          type: string
          format: url
        medium:
          title: Medium
          type: string
          format: url
        small:
          title: Small
          type: string
          format: url
    ErrorDetail:
      title: ErrorDetail
      required:
        - title
        - description
      type: object
      properties:
        title:
          title: Title
          type: string
        description:
          title: Description
          type: string
        detail:
          title: Detail
          oneOf:
            - type: string
            - type: object
              properties:
                error:
                  type: string
                  description: error message
                path:
                  type: string
                  description: request path
  securitySchemes:
    CookiesSession:
      name: sessionID
      type: apiKey
      in: cookie
